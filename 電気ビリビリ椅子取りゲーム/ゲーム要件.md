# 要件定義書：マルチ「電気イス椅子取り」（仮）

## 1. 目的

最大10人（不足分はNPCで補填）で対戦し、各ラウンドで**電気椅子を引いた1名が脱落**。最後まで生き残った1名を勝者とする。
ゲーム性は**運ゲー**に割り切り、テンポ良く進行することを重視する。

---

## 2. 想定プレイ体験（コア体験）

* ルームに集まる → 締切 → 専用ステージへ移動 → 連続ラウンドで脱落 → 観戦 or 退出
* 1ラウンドごとに必ず1名が脱落し、短時間で決着がつく。

---

## 3. スコープ

### 3.1 対象（入れる）

* ルーム選択・マッチ成立（最大10）
* NPC補填
* ラウンド制（毎回1名脱落）
* 椅子数がプレイヤー数に合わせて1つずつ減る
* 脱落者は「退出」または「観戦席」へ
* ゲーム終了・勝者決定・報酬（最低限）

### 3.2 対象外（入れない）

* 読み合い、ヒント、心理戦
* スキル要素（操作精度で有利になる要素）
* 複雑なアイテム／アビリティ
* ランクマ・MMR等

---

## 4. 用語定義

* **ホーム**：プレイヤーが集まるロビー空間
* **ルーム**：参加枠を持つ待機部屋（最大10）
* **ゲームステージ**：椅子が配置された対戦用マップ
* **椅子（Seat）**：1〜Nの識別子を持つ着席対象
* **電気椅子**：各ラウンドで1つだけ存在する脱落トリガー席
* **ラウンド**：電気椅子決定→着席→判定→脱落処理の一連

---

## 5. ゲームルール（仕様）

### 5.1 参加人数

* 1プレイ最大10人
* 開始最低人数：2人（推奨）。不足分はNPCで補填し、**最大10の枠を埋める**

  * 例：実プレイヤー4人＋NPC6体＝10人マッチ

### 5.2 椅子数

* 各ラウンド開始時点の **生存者数 = 椅子数**
* 初回：生存者10人なら椅子10個
* 1人脱落後：生存者9人なら椅子9個
  以後繰り返し

### 5.3 脱落条件

* 各ラウンドで椅子のうち **1つのみ電気椅子**
* **電気椅子に割り当たった1名が脱落**
* 脱落者は「観戦席へ移動」または「退出」を選択可能

### 5.4 勝利条件

* 生存者が1名になった時点でゲーム終了
* 最後の1名が勝者

### 5.5 「椅子選択」の扱い（実装を壊さないための確定仕様）

運ゲーを成立させるため、**座席の割り当てはサーバーが最終確定**する。

* プレイヤー（NPC含む）はラウンド中に「座りたい椅子」を1つ選択する
* **同じ椅子を複数人が選んだ場合**：
  サーバーがその椅子の当選者を1名ランダムで決定し、外れた人は「空いている椅子」にランダム割り当てする
  → これにより「必ず全員が1つの椅子に割り当たる」ことを保証
* タイムアウト時：未選択者はサーバーがランダムで割り当て

※これで毎ラウンド **必ず1名だけが電気椅子に当たる**（仕様が安定します）

---

## 6. 画面・導線（ユーザーフロー）

1. **ホーム画面（ロビー）**
   　プレイヤーが自由に移動・待機。
2. **ルーム選択UI**
   　空いているルームを選び参加。参加人数表示。
3. **〆切（カウントダウン）**
   　制限時間終了 or 定員到達でマッチ確定。
4. **ゲームステージへ移動**
   　参加者（＋NPC）を専用ステージへテレポート。
5. **ゲーム開始 → ラウンド進行**
   　生存者が1名になるまで繰り返し。
6. **結果表示 → リターン**
   　勝者表示、報酬付与、ホームへ戻る。

---

## 7. 機能要件

### 7.1 ルーム／マッチング

* ルーム一覧表示（例：Room1〜RoomK）
* 参加／退出
* 参加者数表示
* 〆切カウントダウン表示
* マッチ確定後、参加者をゲームステージへ移動

### 7.2 NPC補填

* マッチ開始時、参加枠が10未満の場合に不足数分のNPCを生成
* NPCは以下を実行

  * ラウンド開始時にランダムで椅子を選択
  * タイムアウト前に必ず選択する（または未選択扱いでサーバー割当）

### 7.3 ラウンド制御

* ラウンド開始時に椅子を「生存者数」だけ有効化（それ以外は無効化／非表示）
* 電気椅子を1つ決定（サーバー内）
* 各参加者の選択受付（制限時間つき）
* 座席の最終割当（衝突解決＋未選択処理）
* 電気椅子判定→脱落者決定
* 脱落者を観戦席へ移動（または退出処理）

### 7.4 観戦

* 脱落者は観戦席に移動できる
* 観戦中に「退出」ボタンでホームへ戻れる
* 観戦中は次ラウンドの選択には参加しない

### 7.5 結果表示／報酬（最低限）

* 勝者の名前表示
* 報酬（例：コイン）付与

  * 勝者：多め
  * 参加者：少なめ（途中脱落でも参加報酬）

---

## 8. 非機能要件

### 8.1 不正・整合性

* 電気椅子IDはクライアントに事前送信しない（サーバーのみ保持）
* 椅子割当・脱落判定はサーバーのみが確定する
* クライアントからの座席選択は検証する

  * 生存者か
  * 選択フェーズ中か
  * 存在する椅子か（有効椅子か）

### 8.2 パフォーマンス

* 最大10人＋NPCで安定動作
* ラウンド制で繰り返し処理してもメモリリークしない（NPC破棄・イベント解除）

### 8.3 例外・耐障害

* プレイヤーがラウンド中に退出／切断した場合

  * その人は即脱落扱い、座席割当から除外
  * 生存者数が変わるため、次ラウンドの椅子数を再計算
* マッチ確定後に人数が2未満になった場合

  * 試合を中断しホームへ戻す（返金/無報酬などは設計に合わせる）

---

## 9. 状態遷移（ステートマシン）

* **Home**
* **RoomWait**
* **MatchLock（〆切・確定）**
* **TeleportToStage**
* **RoundInit**
* **SeatPickPhase（制限時間）**
* **SeatAssign（衝突解決・未選択処理）**
* **Resolve（電気判定・脱落演出）**
* **Cleanup（脱落移動・次ラウンド準備）**
* **GameEnd（勝者表示）**
* **ReturnToHome**

---

## 10. サーバーデータ設計（最小）

* `matchId`
* `playersAlive: {playerId -> true}`
* `playersSpectating: {playerId -> true}`
* `npcAlive: {npcId -> true}`
* `seatCount: number`（= aliveCount）
* `activeSeats: [seatId]`
* `dangerSeatId: seatId`
* `picks: {participantId -> seatId}`（希望）
* `assignedSeats: {participantId -> seatId}`（確定）
* `roundIndex`
* `timers`（pickPhaseRemainingなど）

---

## 11. 受け入れ基準（完成判定）

* 10人（不足分NPC）でマッチが開始できる
* 毎ラウンド、必ず1名だけ脱落する
* 生存者数に応じて椅子数が1つずつ減る
* 脱落者が観戦できる／退出できる
* 最後の1名が勝者として確定し、結果が表示される
* 電気椅子情報が事前に漏れない（サーバー管理）

---

ここまでが「そのまま運ゲー」での要件定義です。

次に進めるなら、私の方で **Explorer構成（フォルダツリー）＋RemoteEvent設計＋RoundControllerの擬似コード（Luau）**まで出せます。
特に重要なのは「椅子の衝突解決」と「必ず1人だけ脱落の保証」なので、そこを中心に骨組みを書きます。
