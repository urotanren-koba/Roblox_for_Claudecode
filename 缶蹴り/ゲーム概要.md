
---

# 要件定義（アップデート版）

## 1. ゲーム概要

* 缶蹴りの構造を現代化した「**高速鬼（NPC）から逃げつつ、HP地点（＝缶の代替）を攻撃して鬼HPを0にする**」スリル型ゲーム。
* 鬼は極めて高速で、発見されると基本不利。ただし **安全ゾーン** と **仲間の介入（HP地点攻撃による追跡中断）** で逆転の余地を残す。

## 2. プレイモード

* ソロ／マルチ対応（同一ルール）
* マルチは「追われている仲間を、HP地点攻撃で救う」チームプレイが自然発生する設計。

## 3. 勝利／敗北条件

* 勝利：鬼HP（数値）を **0** にする。
* 敗北：自プレイヤーHP（ライフ）が **0** で、かつ復帰（ダイヤ消費）を行わずラウンド継続不能となる状態。

  * ※ラウンド時間制限の有無は調整事項（後述のConfigで対応）

## 4. 主要オブジェクト

* **HP地点（攻撃対象）**：ゲーム開始時にステージ内へランダム出現 → 以後固定。
* **安全ゾーン**：ステージ内に常に **1個のみ**。ランダム出現。使用後は消滅し、別位置へ再抽選で出現。

## 5. 成長／課金の基本方針

* 強くなったプレイヤーが低レベル鬼を**ワンパン**しても許容（成長体験を優先）。
* 課金・ガチャは **攻撃力（火力）** のみに影響。
* **攻撃クールダウン（10秒）や攻撃回数・追跡ルールに課金を絡めない**（公平性維持）。

---

# 機能要件（アップデート版）

## 1. ラウンド生成・進行

* ラウンド開始時に生成／初期化

  * HP地点：ランダム配置 → 以後固定
  * 安全ゾーン：ランダム配置（常に1個）
  * 鬼：巡回状態で開始
  * プレイヤー：HP=3で開始
* ラウンド終了判定（勝利／敗北／時間切れなど）はサーバーで管理（※時間切れは任意Config）

## 2. HP地点への攻撃

* HP地点はプレイヤーが攻撃可能。
* **攻撃クールダウン**：1回攻撃されると **10秒間攻撃不可**
* ダメージ計算

  * 総攻撃力 = 武器攻撃力 + プレイヤー基礎攻撃力（レベル等）
  * 鬼HP = 鬼HP - 総攻撃力
* UI表示

  * 鬼HPゲージ
  * HP地点の攻撃可否（クールダウン残秒）

## 3. プレイヤーHP（ライフ）と復帰

* プレイヤーHP：初期3
* 鬼に追いつかれる（捕捉成功）と **即死級攻撃** → プレイヤーHP-1
* プレイヤーHPが0になった場合

  * **ダイヤ1個消費で復帰可能**
  * 復帰時HPは **1**
  * 復帰位置は「安全な復帰地点」へ（即リスキル防止）

## 4. 鬼AI（状態と遷移）

### 4.1 巡回状態

* ステージ内を巡回し索敵。
* プレイヤーを発見したら追跡状態へ。

### 4.2 索敵条件（視界のみ／遮蔽物で完全遮断）

* 音は関係なし。
* 発見条件（すべて満たす）

  1. 距離：索敵距離以内（数値は調整）
  2. 視野角：視野角以内（数値は調整）
  3. 遮蔽物：鬼→プレイヤー直線が遮られていない（遮られていれば **0%発見**）
* 見失い猶予：遮蔽物に入って見失った後の追跡継続猶予（秒数は調整）

※遮蔽物判定対象は「遮蔽物タグ付きオブジェクト」に限定し、柵や小物で誤遮断しないようにする。

### 4.3 追跡状態

* 追跡中は **HP地点を無視** し、プレイヤーのみを狙う。
* 追跡対象優先：**距離が近いプレイヤー**（揺れ対策は必要なら後で閾値追加）
* 捕捉成功：即死級攻撃 → プレイヤーHP-1 → 巡回へ復帰

### 4.4 追跡中断条件

* 追跡中断は以下のいずれかで発生

  1. **HP地点が攻撃された**
  2. 追跡対象が **安全ゾーンに入った**（安全ゾーン内は鬼から不可視扱い）
* 中断時挙動（演出含む）

  * 鬼が **3秒間弱る演出**
  * その後、超高速で所定位置へ戻り巡回再開（戻り先はHP地点周辺推奨）

## 5. 安全ゾーン仕様

* 常に **1個のみ**存在
* ランダム出現。ただし出現制約あり

  * **HP地点から一定距離以上離れた場所**にのみ出現（Rminは調整）
* 使用

  * 入ると鬼から不可視（追跡中断トリガー）
  * 最大10秒滞在可能
  * 使用終了後：消滅 → 別位置にランダム再出現

## 6. マルチ時の鬼HPスケーリング

* 鬼HPスケーリング（案）

  * 鬼HP = 基本HP × (1 + α × (人数 - 1))
  * αは仮に **0.2** を初期値候補
* 途中離脱対策

  * 人数変動時に最大HPを再計算し、不利になりすぎないよう調整
  * 反映は段階的（例：10〜15秒でなじませる）にして悪用を抑える

---

# 非機能要件（アップデート版）

## 1. 公平性／セキュリティ

* ダメージ計算、HP地点クールダウン、鬼AI状態遷移、復帰処理は **サーバー権威**。
* クライアント改変で攻撃・クールダウン・索敵が変わらないこと。
* ダイヤ消費（復帰）は二重消費・巻き戻りが起きない実装にする。

## 2. パフォーマンス／安定性

* 鬼の高速移動や索敵（Raycast/Line-of-sight）を行ってもサーバー負荷が過大にならないこと。
* 安全ゾーンの再抽選・HP地点クールダウン管理がラグで破綻しないこと。

## 3. 可用性／マルチ変動耐性

* 途中参加・途中離脱が起きてもラウンドが継続できる。
* 人数変動に応じた鬼HP再計算が自然に反映される。

## 4. UX（分かりやすさ）

* UIで最低限を表示

  * 鬼HP、プレイヤーHP、HP地点クールダウン、復帰（ダイヤ1）導線
* 「追われている→誰かがHP地点を攻撃→鬼が怯んで追跡中断」の因果が視覚的に伝わる演出。

---

# 調整項目（Config化する前提）

* 索敵距離
* 視野角
* 見失い猶予
* 安全ゾーンのHP地点からの最小距離（Rmin）
* α（鬼HPスケーリング係数）
* ラウンド時間制限の有無／時間切れルール（必要なら）

---

この版をベースに、次は「Configテーブル（鬼Lv別HP、武器レア別攻撃力、α、各秒数）」を表で作ると、実装と調整が一気に楽になります。必要でしたら、その表もこちらで作成します。
