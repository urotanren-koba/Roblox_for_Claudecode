# 缶蹴りゲーム 開発記録

## 現在の状態

### 完了済み

#### ステージ準備
- [x] 建物の高さ調整（8個の建物を地面Y=0に合わせた）
- [x] モンスター無効化（HorrorGameManager を Disabled = true）
- [x] 軽量化実施
  - ライト: 203個 → 14個（建物内ライト無効化、街灯半分無効化）
  - エフェクト: 75個 → 0個（全て無効化）
  - スクリプト: 140個 → 9個（モデル付属スクリプト110個無効化）

#### フェーズ1: 基盤システム
- [x] フォルダ構造作成
- [x] GameConfig（設定モジュール）作成
- [x] RoundManager（ラウンド管理）作成
- [x] GameController（メインスクリプト）作成
- [x] RemoteEvents作成（13個）

#### フェーズ2: コアオブジェクト
- [x] HP地点（缶の代替）実装
  - HPPointManager モジュール作成
  - GoalPositionsからランダム配置
  - ProximityPromptで攻撃可能
  - 10秒クールダウン（ビジュアル表示付き）
  - **火の玉/魂ビジュアル「魂の炎」に更新済み**
- [x] 安全ゾーン実装
  - SafeZoneManager モジュール作成
  - HP地点から30スタッド以上離れた場所に出現
  - 10秒滞在で消滅→2秒後に別位置へ再出現
  - 緑の光る円柱＋ForceFieldエフェクト
  - 滞在時間カウントダウン表示
- [x] GameController更新（フェーズ2統合）

---

## Roblox Studio 構造

```
ReplicatedStorage/
  └── KanKeri/
      ├── Config/
      │   └── GameConfig (ModuleScript)
      ├── Modules/
      └── Events/
          ├── RoundStateChanged
          ├── RoundCountdown
          ├── RoundStarted
          ├── RoundEnded
          ├── OniHPChanged
          ├── PlayerHPChanged
          ├── PlayerDied
          ├── PlayerRevived
          ├── OniStateChanged
          ├── HPPointCooldownUpdate
          ├── RequestAttackHPPoint
          ├── RequestRevive
          └── RequestStartRound

ServerScriptService/
  └── KanKeri/
      ├── Modules/
      │   ├── RoundManager (ModuleScript)
      │   ├── HPPointManager (ModuleScript)
      │   └── SafeZoneManager (ModuleScript)
      └── Controllers/
          └── GameController (Script, 有効)

Workspace/
  ├── HPPoints/ (ラウンド開始時に生成)
  │   └── HPPoint_1 (Model)
  └── SafeZones/ (ラウンド開始時に生成)
      └── SafeZone (Model)
```

---

## 次のタスク

### フェーズ3: 鬼AI
- [ ] 鬼NPC作成（PatrolPoints巡回）
- [ ] 索敵システム（距離+視野角+Raycast遮蔽判定）
- [ ] 追跡システム（プレイヤー追跡、捕捉→ダメージ）
- [ ] 追跡中断（HP地点攻撃/安全ゾーンで中断→弱体化演出）

### フェーズ4: プレイヤー
- [ ] プレイヤーHP（初期3、被ダメージ処理）
- [ ] 攻撃システム（HP地点への攻撃、ダメージ計算）
- [ ] 復帰システム（HP0→ダイヤ消費で復帰）

### フェーズ5: UI
- [ ] 鬼HPゲージ
- [ ] プレイヤーUI（HP、クールダウン、復帰ボタン）

### フェーズ6: マルチ対応
- [ ] HPスケーリング（人数に応じた鬼HP調整）

---

## 既存ステージのアセット

| 種類 | 数量 | 用途 |
|------|------|------|
| 道路（十字路） | 1 | - |
| 道路（丁字路） | 4 | - |
| 道路（右） | 2 | - |
| Abandoned House | 8 | 遮蔽物 |
| Abandoned Building | 4 | 遮蔽物 |
| Small House | 1 | 遮蔽物 |
| Village House | 2 | 遮蔽物 |
| Builidng | 4 | 遮蔽物 |
| Street lamp | 28 | 雰囲気（半分有効） |
| PatrolPoints | 6箇所 | 鬼の巡回ルート |
| GoalPositions | 8箇所 | HP地点/安全ゾーン候補 |

---

## GameConfig 設定値

```lua
-- 鬼
Oni.BaseHP = 100
Oni.MoveSpeed = 24
Oni.ChaseSpeed = 32
Oni.DetectionRange = 50
Oni.FieldOfView = 120
Oni.LoseSightGracePeriod = 3
Oni.StunDuration = 3
Oni.HPScalingAlpha = 0.2

-- HP地点
HPPoint.AttackCooldown = 10
HPPoint.InteractionRange = 5

-- 安全ゾーン
SafeZone.MaxStayDuration = 10
SafeZone.MinDistanceFromHPPoint = 30
SafeZone.RespawnDelay = 2

-- プレイヤー
Player.MaxHP = 3
Player.ReviveHP = 1
Player.ReviveDiamondCost = 1
Player.MoveSpeed = 16
Player.BaseAttackPower = 10

-- ラウンド
Round.CountdownTime = 5
Round.TimeLimit = 0
Round.MinPlayersToStart = 1

-- デバッグ
Debug.Enabled = true
```

---

## 魂の炎（HP地点）ビジュアル調整メモ

今後調整する可能性があるパラメータ：

### 通常状態（攻撃可能）
| パーツ | プロパティ | 現在値 | 備考 |
|--------|------------|--------|------|
| SoulCore（外球） | Color | RGB(255, 150, 50) | オレンジ |
| SoulCore | Size | 3, 3, 3 | 球体サイズ |
| SoulCore | Transparency | 0.3 | |
| InnerCore（内核） | Color | RGB(255, 255, 200) | 明るい黄白 |
| InnerCore | Size | 1.5, 1.5, 1.5 | |
| Base（地面円） | Color | RGB(255, 100, 50) | |
| Base | Size | 直径8スタッド | |
| MainLight | Color | RGB(255, 150, 50) | |
| MainLight | Brightness | 3 | |
| MainLight | Range | 25 | |
| FireParticle | Rate | 30 | 火の粉の量 |
| AuraParticle | Rate | 10 | オーラの量 |

### クールダウン状態（攻撃不可）
| パーツ | プロパティ | 現在値 | 備考 |
|--------|------------|--------|------|
| SoulCore | Color | RGB(100, 120, 180) | 青系 |
| SoulCore | Transparency | 0.6 | より透明 |
| InnerCore | Color | RGB(150, 170, 220) | |
| Base | Color | RGB(80, 100, 150) | |
| MainLight | Brightness | 1 | 暗め |
| FireParticle | Rate | 5 | 少なめ |
| AuraParticle | Rate | 3 | 少なめ |
| ラベル | Text | "回復中..." | |

---

## 注意事項

- HorrorGameManagerは無効化されているが削除はしていない
- 建物内ライト・エフェクトは無効化のみ（削除していない）
- デバッグモードON（プレイヤー参加3秒後に自動ラウンド開始）

---

## パトカーライト点滅

- **Sirenスクリプト**: 30個を無効化（エラー解消）
- **サウンド**: 20個を削除（アクセス権限エラー解消）
- **PoliceLightFlash**: ServerScriptServiceに新規作成
  - G1ライト（青）とG2ライト（赤）が0.3秒間隔で交互に点滅
  - パトカー5台分のライトを自動検出
